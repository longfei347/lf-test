<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<title>Hello, World</title>
<style type="text/css">
</style>
<!-- lbsyun.baidu.com/apiconsole/key#
<link src="http://api.map.baidu.com/res/11/bmap.css"  rel="stylesheet">
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>-->
<script src="js/j.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=iPKUt5XVqzV774lD4gEzGVYS2fmUKdlv"></script>
<!--<script type='text/javascript' src='http://tb.53kf.com/kf.php?arg=10065481&style=4'> </script>
 //此为v1.5版本的引用方式 key=SZmGyZCCDVGGmYp5hFfSDdZ3
// http://api.map.baidu.com/api?v=1.5&key=SZmGyZCCDVGGmYp5hFfSDdZ3&amp;callback=initialize"; //此为v1.4版本及以前版本的引用方式
var map = new BMap.Map("container"); //创建地图实例可是id或元素对象
var point = new BMap.Point(116.404, 39.915); //创建一个坐标点
map.centerAndZoom(point, 15);//设置中心点坐标和地图级别
// 地图控件
Control：控件的抽象基类，所有控件均继承此类的方法、属性。通过此类您可实现自定义控件。
NavigationControl：地图平移缩放控件，PC端默认位于地图左上方，它包含控制地图的平移和缩放的功能。移动端提供缩放控件，默认位于地图右下方。
OverviewMapControl：缩略地图控件，默认位于地图右下方，是一个可折叠的缩略地图。
ScaleControl：比例尺控件，默认位于地图左下方，显示地图的比例关系。
MapTypeControl：地图类型控件，默认位于地图右上方。
CopyrightControl：版权控件，默认位于地图左下方。
GeolocationControl：定位控件，针对移动端开发，默认位于地图左下方。
map.addControl(new BMap.NavigationControl());
map.addControl(new BMap.ScaleControl());
map.addControl(new BMap.OverviewMapControl());
map.addControl(new BMap.MapTypeControl());
map.setCurrentCity("北京"); // 仅当设置城市信息时，MapTypeControl的切换功能才能可用

初始化控件时，可提供一个可选参数，其中的anchor和offset属性共同控制控件在地图上的位置
anchor允许的值为：
BMAP_ANCHOR_TOP_LEFT 表示控件定位于地图的左上角。
BMAP_ANCHOR_TOP_RIGHT 表示控件定位于地图的右上角。
BMAP_ANCHOR_BOTTOM_LEFT 表示控件定位于地图的左下角。
BMAP_ANCHOR_BOTTOM_RIGHT 表示控件定位于地图的右下角。
控件位置偏移
var opts = {offset: new BMap.Size(150, 5)}
map.addControl(new BMap.ScaleControl(opts));
//修改控件配置
NavigationControl控件就提供了如下类型：
BMAP_NAVIGATION_CONTROL_LARGE 表示显示完整的平移缩放控件。
BMAP_NAVIGATION_CONTROL_SMALL 表示显示小型的平移缩放控件。
BMAP_NAVIGATION_CONTROL_PAN 表示只显示控件的平移部分功能。
BMAP_NAVIGATION_CONTROL_ZOOM 表示只显示控件的缩放部分功能。
var opts = {type: BMAP_NAVIGATION_CONTROL_SMALL}
map.addControl(new BMap.NavigationControl(opts));


-->
</head>

<body>
<!-- <div id="container" style="width:500px; height:300px"></div> -->
<div id="baidu_map" style="width:500px; height:300px"></div>
<script type="text/javascript">
var fn = function fn_alias(){
	console.log(fn_alias);
};
(function () {
	// var map = new BMap.Map("container");          // 创建地图实例
	/*new BMap.Geocoder().getPoint("江苏省连云港市万润街五岔路口", function (point) {
		console.log(point)
		map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别
		//map.centerAndZoom(point,16);
		map.enableScrollWheelZoom();
		map.addControl(new BMap.NavigationControl());
		var transit = new BMap.TransitRoute(map, {
			renderOptions: {map: map}
		});
		var marker = new BMap.Marker(point);
		map.addOverlay(marker);
		marker.addEventListener("click",function(){
			var sContent = '<div class="didInfoWindow">'
				+ '<p><input type="text" name="qidian"></p>'
				+ '<p><button type="button" id="seachRoute">搜索</button></p></div>'
			this.openInfoWindow(new BMap.InfoWindow(sContent))
			$("#seachRoute").on("click",function() {
				if ($("input[name=qidian]").val() == "") {
					alert("请输入起点")
				} else {
					transit.search($("input[name=qidian]").val(), "大冲");
				}
			})
			console.log("yes");
		})

	})*/
	/*function showMap() {
		map_load();
		$("#baidu_map").window('open');
	}
	function map_load() {
		var load = document.createElement("script");
		load.type = "text/javascript";
		load.src = "http://api.map.baidu.com/api?v=2.0&ak=EB2d0758c135a0ebd9bb23a2bda33510&callback=map_init";
		document.body.appendChild(load);
	}*/
	var lng = 0.0;
	var lat = 0.0;
	var map = new BMap.Map("baidu_map");
	/*var lng = 119.195555;//$("#lng").textbox('getValue');
		var lat = 34.615151;//$("#lat").textbox('getValue');
		var point = new BMap.Point(lng, lat);
		map.centerAndZoom(point,16);*/

	var geolocation = new BMap.Geolocation();
	// 开启SDK辅助定位
	geolocation.enableSDKLocation();
	geolocation.getCurrentPosition(function(position) {
		console.log("position:", position)
		if (this.getStatus() === BMAP_STATUS_SUCCESS) {
			console.log(position)
			// new BMap.Marker().setPosition(position.point);
			// var marker = new BMap.Marker(position.point);  // 创建标注
			// map.addOverlay(marker);
			// map.centerAndZoom(position.point,16)
			console.log('source:', position.point)
			let convertor = new BMap.Convertor(); 
      let pointArr = []; 
      pointArr.push(position.point); 
      convertor.translate(pointArr, 1, 5, data => { 
        if(data.status === 0) { 
        	console.log('target:', data.points[0])
          let marker = new BMap.Marker(data.points[0]); 
          map.addOverlay(marker); 
          let label = new BMap.Label("您的位置!",{offset:new BMap.Size(20,-10)}); 
          marker.setLabel(label); //添加百度label
          map.centerAndZoom(data.points[0],16)
          // map.setCenter(data.points[0]);
        } 
      }) 
		} else {
			console.log('failed' + this.getStatus());
			err && err(this.getStatus())
		}
	}, {
		enableHighAccuracy: true,
		maximumAge: 5 * 60 // 缓存5分钟
	})
	navigator.geolocation.getCurrentPosition(function(position) {
		var x = position.coords.longitude; //经度 
		var y = position.coords.latitude;//纬度 
		console.log('lon:',x,"lat:",y)
		// transTypesParam = getTransType(position.coords.accuracy);//该方法很重要，用来判断手机定位格式，方法在下方
		/*if($("#testInfo") != null && $("#testInfo").length >0) {
			$("#testInfo").html("accuracy : " + position.coords.accuracy +  "x : " + x + "  y : " + y);
		}*/
		// var ggPoint = new BMap.Point(x,y);
		// showMap(ggPoint, true);//显示地图坐标
	}, function(err) {
		console.log(err)
	});
	/*(function map_init() {

		var lng = 119.195555;//$("#lng").textbox('getValue');
		var lat = 34.615151;//$("#lat").textbox('getValue');
		var point = new BMap.Point(lng, lat);
		map.centerAndZoom(point,16);
		var marker = new BMap.Marker(point);
		marker.enableDragging();
		map.addOverlay(marker);

		marker.addEventListener("mouseover", function () {
			var newPoint = marker.getPosition();
			var self = this;
			console.log(newPoint);
			var content = '';
			var geoc = new BMap.Geocoder();
			geoc.getLocation(newPoint, function(rs) {
				var address = rs.addressComponents;
				console.log(address);
				content += address.city+address.district+address.street+address.streetNumber;
				content +="<br/><br/>经度:"+newPoint.lng+ "<br/>纬度:"+newPoint.lat;
				console.log(content);
				var infoWindow = new BMap.InfoWindow("<p style='font-size:14px;'>"+content+"</p>");
				self.openInfoWindow(infoWindow);
			});
			console.log(content);
			// this.openInfoWindow(infoWindow);
		});

		map.enableScrollWheelZoom(true);
		map.enableContinuousZoom(true);
		map.addControl(new BMap.NavigationControl());
		map.addControl(new BMap.OverviewMapControl());
		map.addControl(new BMap.OverviewMapControl({ isOpen: true, anchor: BMAP_ANCHOR_BOTTOM_RIGHT }));
	})()*/

	var geolocationControl = new BMap.GeolocationControl();
	  geolocationControl.addEventListener("locationSuccess", function(e){
	    // 定位成功事件
	    var address = '';
	    address += e.addressComponent.province;
	    address += e.addressComponent.city;
	    address += e.addressComponent.district;
	    address += e.addressComponent.street;
	    address += e.addressComponent.streetNumber;
	    //alert("当前定位地址为：" + address);
	  });
	  /*geolocationControl.addEventListener("locationError",function(e){
	    // 定位失败事件
	    alert(e.message);
	  });*/
	  map.addControl(geolocationControl);

	/*$("#baidu_map").panel('onClose',function(){
		console.log('window closed');
	})*/
	//var point = new BMap.Point("深圳市");  // 创建点坐标
	//map.addControl(new BMap.ScaleControl());
	//map.addControl(new BMap.OverviewMapControl());
	//map.setCurrentCity("北京");
	//map.addControl(new BMap.MapTypeControl());
})();
</script>
</body>
</html>
