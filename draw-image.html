<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>

<body>
	<canvas id="myCanvas" width="600" height="400"></canvas>
</body>
<script>
var canvas = document.getElementById("myCanvas"),
	ctx = canvas.getContext("2d");

var image = new Image();
image.src = 'images/star_0.png'; // 42*42
image.onload = function() {
	ctx.drawImage(image, 100, 100);
}
var imageData = ctx.getImageData(0, 0, 42, 42);
var particles = [];

function calculate() {
	var len = imageData.data.length;
	var cols = 42,
		rows = 42;
	var //s_width = parseInt(image.w / cols),
		//s_hwight = parseInt(image.h / rows),
		pos = 0,
		i, j,
		par_x, par_y,
		data = imageData.data;
	for (i = 1; i <= cols; i++) {
		for (j = 1; j <= rows; j++) {
			pos = [(j - 1) * 42 + (i - 1)] * 4;

			if (data[pos] > 168) {
				var particle = {
					x: image.x + i * s_width + (Math.random() - 0.5) * 20,
					y: image.y + i * s_height + (Math.random() - 0.5) * 20,
					fillStyle: "#006eff"
				}
				particles.push(particle);
			}
		}
	}

}

function draw(argument) {
	//清空画布
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	var len = particles.length,
		curr_particle = null;
	for (var i = 0; i < len; i++) {
		curr_particle = particles[i];
		ctx.fillStyle = curr_particle.fillStyle;
		ctx.fillRect(curr_particle.x, curr_particle.y, 1, 1);

	}
}
</script>

</html>
