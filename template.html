<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <!-- <link rel="prefetch" href="js/lite.js" as="script"> -->
</head>

<body>
  <p class="load-p"></p>
  <a href="blob:https://developer.mozilla.org/58702010-433d-4097-990f-e483d84cd02a" download="file.json">下载文件链接</a>
  <!-- <iframe src="aa.html" frameborder="0"></iframe> -->
</body>
<script src="js/lesson/messagechannel.js"></script>
<script>
/*var channel = new MessageChannel();
var para = document.querySelector('.load-p');
var ifr = document.querySelector('iframe');
var otherWindow = ifr.contentWindow;
ifr.addEventListener("load", function iframeLoaded() {
  // console.log('postmessage', channel)
  // otherWindow.postMessage('Hello from the main page!', '*', [channel.port2]); // 有问题
  // otherWindow.parent.channel.port2.postMessage('Hello from the main page!', '*', [channel.port2]); // 有问题
  // Failed to execute 'postMessage' on 'MessagePort': No function was found that matched the signature provided.
  // channel.port2.postMessage('Hello from the main page!')
}, false)
channel.port1.onmessage = function handleMessage(e) {
  console.log('onmessage: ', e.data)
  para.innerHTML = e.data;
}*/

// 通过src获取图片的blob对象
function getImageBlob(url, cb) {
  var xhr = new XMLHttpRequest();
  xhr.open("get", url, true);
  xhr.responseType = "blob";
  let reader = new FileReader();
  reader.addEventListener("loadend", function() {
    console.log(reader.result);
  });
  xhr.onload = function() {
    if (this.status == 200) {
      let blob = this.response;
      // 读取来看下下载的内容
      reader.readAsDataURL(blob);
      // 最终生成的字符串
      // data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAA...
      // 生成下载用的URL对象
      let url = URL.createObjectURL(blob);
      // 生成一个a标签，并模拟点击，即可下载，批量下载同理
      let aDom = document.createElement('a');
      aDom.href = url;
      aDom.download = 'download.png';
      aDom.text = '下载文件';
      document.getElementsByTagName('body')[0].appendChild(aDom);
      aDom.click();
    }
  };
  xhr.send();
}
var _toString = Object.prototype.toString;

function toRawType (value) {
  return _toString.call(value).slice(8, -1)
}
/*console.log('string:', toRawType(''))
console.log('number:', toRawType(1))
console.log('bool:', toRawType(true))
console.log('null:', toRawType(null))
console.log('symbol:', toRawType(Symbol()))
console.log('undefined:', toRawType(undefined))
console.log('function:', toRawType(function(){}))
console.log('obj:', toRawType({}))
console.log('array:', toRawType([]))
console.log('set:', toRawType(new Set()))
console.log('weakset:', toRawType(new WeakSet()))
console.log('map:', toRawType(new Map()))
console.log('weakMap:', toRawType(new WeakMap()))*/


// getImageBlob('https://cdn.segmentfault.com/v-5c4ec07f/global/img/user-64.png')
/*let obj2 = { foo: 123 };
Object.getOwnPropertyDescriptor(obj2, 'foo')
//  {
//    value: 123,
//    writable: true,
//    enumerable: true,
//    configurable: true
//  }*/
//
/*let obj={a:1, b:2}
let obs='{a:1,b:2}'
for (let key of obs) {
  console.log(key, obs[key])
}*/
/*const pipe = (...fs) => p => fs.reduce((v, f) => f(v), p)
function pipe(...fs) {
  return function (p) {
    fs.reduce(function(v, f) {
      return f(v)
    }, p)
  }
}
alert(a)
a();
var a=3;
function a(){
    alert(10)
}
alert(a)
a=6;
a();// 这里报错
var aa =()=> console.log(this)
aa.call({a:1}) // 箭头函数里的this不能改变*/

</script>

</html>
